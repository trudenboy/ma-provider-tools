name: Auto-add issues to project

on:
  issues:
    types: [labeled]

permissions:
  issues: read

jobs:
  add-to-project:
    if: {% raw %}${{ startsWith(github.event.label.name, 'incident:') }}{% endraw %}
    runs-on: ubuntu-latest
    steps:
      - name: Add to MA Ecosystem project
        env:
          GH_TOKEN: {% raw %}${{ secrets.FORK_SYNC_PAT }}{% endraw %}
        run: |
          gh api graphql -f query='
            mutation($pid:ID!,$iid:ID!){
              addProjectV2ItemById(input:{projectId:$pid,contentId:$iid}){
                item{id}
              }
            }' \
            -f pid="PVT_kwHOCFMIf84BPvYe" \
            -f iid="{% raw %}${{ github.event.issue.node_id }}{% endraw %}"
